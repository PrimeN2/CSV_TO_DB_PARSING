# Ход работы

## Навигация

- [Нормализованная БД](db/output/final.db)
- [Исходная БД](db/recovered.db)
- [SQL код](db/output/SQL_normalization.sql)
- [CSV фалы](csv/)

## Проблемы, которые нужно исправить при парсинге .csv файлов

### Sales.csv

- Десятичные разделители в виде запятых (e.g., 113,33) вместо точек. Меняем в столбце "Себестоимость" запятые на точки.
- Экспоненциальная запись в скидках (e.g., 1.4210854715202E-13). Округляем до разумных значений и записываем в .csv
- Формат даты DD.MM.YYYY может не распознаваться SQLite автоматически. Нужно установить "'dayfirst': True"

### Sums_Check.csv

- Название "Сумма покупки|Сумма" содержит недопустимый символ "|", что вызовет ошибку при создании таблицы.

### Общие проблемы

- Кириллица потребует указания кодировки UTF-8.
- Названия столбцов на кириллице, необходимо переименовать на английский (по ТЗ).

---

## Нормализация БД (3НФ)

### Таблица 'clients':

#### Нарушение 1НФ:

- Поле client_name содержит составные данные (название организации и ИНН в одной строке). Пример: ООО "Положение" ИНН 7896913934 — смешаны текст и числовой идентификатор. 

**Исправление:** Разделить на два поля: company_name и inn.

---

### Таблица 'products':

#### Нарушение 1НФ:

- **Проблема**:  
  Поле `product_key` содержит составной ключ (например, `1_1_1`), который, вероятно, кодирует несколько параметров (например, `category_id_subcategory_id_unique_id`).

- **Исправление**:
  1. Выделить уникальную часть `product_key` как `product_id` (например, `1` из `1_1_1`).
  2. Сделать `product_id` числовым и использовать его как первичный ключ (`PRIMARY KEY`).
  3. Оставить исходный `product_key` как отдельное поле для обратной совместимости (опционально).

---

### Таблица 'sales':

#### Нарушение 1НФ:

- Поле check_number в некоторых строках пустое (например, первая строка), что может указывать на отсутствие обязательного значения.

**Исправление:** Убедиться, что check_number всегда заполнен и уникален.

#### Нарушение 2НФ:

- Поля address, delivery_car, branch зависят от client_id, а не от первичного ключа таблицы sales.

*Пример:* Адрес 410779, г. Саратов... повторяется для всех продаж клиента CL_01.

**Исправление:** Вынести адрес и данные о доставке в таблицу clients или создать отдельную таблицу delivery_info.

#### Нарушение 3НФ:

- Поля purchase_amount и cost избыточны, так как могут быть вычислены через quantity и цену продукта из таблицы products.

*Пример:* Если quantity = 25 и цена продукта известна, purchase_amount = quantity * price.

**Исправление:** Удалить purchase_amount и cost, оставив только quantity и ссылку на актуальную цену в products.

---

### Таблица 'sums_check':

#### Нарушение 1НФ:

- Поле check_number не заполнено в таблице sales, но присутствует в sums_check. Это может указывать на несогласованность данных.

**Исправление:** Убедиться, что check_number является первичным ключом и связан с обеими таблицами.

#### Нарушение 2НФ:

- Поля address, delivery_car, branch дублируются в таблицах sales и sums_check, что создает избыточность.

**Исправление:** Удалить эти поля из sums_check, оставив только ссылку на client_id и check_number.

#### Нарушение 3НФ:

- Поле purchase_sum зависит от check_number, но может быть вычислено через данные из sales.

**Исправление:** Удалить purchase_sum, рассчитывая итог на этапе выборки данных.

---

### Общие проблемы:

- Дублирование данных:
Поля branch, address, delivery_car повторяются в sales и sums_check.

**Исправление:** Создать таблицу branches с полями branch_id, branch_name, address.

- Отсутствие связей:
Нет явных внешних ключей между таблицами. 

*Например:*
sales.product_key должен ссылаться на products.product_key.
sales.client_id должен ссылаться на clients.client_id.

- Некорректные типы данных:
Поле client_id содержит значения в формате CL_01, CL_10001 — вероятно, это строки, а не числовые идентификаторы, что усложняет сортировку и поиск.