# Ход работы

## Навигация

- [Нормализованная БД](db/output/final.db)
- [Исходная БД](db/recovered.db)
- [SQL код](db/output/SQL_normalization.sql)
- [CSV фалы](csv/)

## Порядок выполнения SQL запросов

1. [Нормализация products](/db/output/SQL/products_normalization.sql)
2. [Нормализация clients](/db/output/SQL/clients_normalization.sql)
3. [Нормализация sums_check](/db/output/SQL/sums_check_normalizations.sql)
4. [Нормализация sales](/db/output/SQL/sales_normalization.sql)

## Проблемы, которые нужно исправить при парсинге .csv файлов

### Sales.csv

- Десятичные разделители в виде запятых (e.g., 113,33) вместо точек. Меняем в столбце "Себестоимость" запятые на точки.
- Экспоненциальная запись в скидках (e.g., 1.4210854715202E-13). Округляем до разумных значений и записываем в .csv
- Формат даты DD.MM.YYYY может не распознаваться SQLite автоматически. Нужно установить "'dayfirst': True"

### Sums_Check.csv

- Название "Сумма покупки|Сумма" содержит недопустимый символ "|", что вызовет ошибку при создании таблицы.

### Общие проблемы

- Кириллица потребует указания кодировки UTF-8.
- Названия столбцов на кириллице, необходимо переименовать на английский (по ТЗ).

---

## Нормализация БД (3НФ)

### Таблица 'clients':

#### Нарушение 1НФ:

- Поле client_name содержит составные данные (название организации и ИНН в одной строке). Пример: ООО "Положение" ИНН 7896913934 — смешаны текст и числовой идентификатор. 

**Исправление:** Разделить на два поля: company_name и inn.

---

### Таблица 'products':

#### Нарушение 1НФ:

- **Проблема**:  
  Поле `product_key` содержит составной ключ (например, `1_1_1`), который, вероятно, кодирует несколько параметров (например, `category_id_subcategory_id_unique_id`).

- **Исправление**:
  1. Выделить уникальную часть `product_key` как `product_id` (например, `1` из `1_1_1`).
  2. Сделать `product_id` числовым и использовать его как первичный ключ (`PRIMARY KEY`).
  3. Оставить исходный `product_key` как отдельное поле для обратной совместимости (опционально).

---

### Таблица 'sales':

#### Нарушение 1НФ:

- Поле check_number в некоторых строках пустое (например, первая строка), что может указывать на отсутствие обязательного значения.

**Исправление:** Убедиться, что check_number всегда заполнен и уникален.

---

### Таблица 'sums_check':

#### Нарушение 1НФ:

- Поле check_number не заполнено в таблице sales, но присутствует в sums_check. Это может указывать на несогласованность данных.

**Исправление:** Убедиться, что check_number является первичным ключом и связан с обеими таблицами.

---

### Общие проблемы:

- Отсутствие связей:
Нет явных внешних ключей между таблицами. 

*Например:*
sales.product_key должен ссылаться на products.product_key.
sales.client_id должен ссылаться на clients.client_id.

- Некорректные типы данных:
Поле client_id содержит значения в формате CL_01, CL_10001 — вероятно, это строки, а не числовые идентификаторы, что усложняет сортировку и поиск.